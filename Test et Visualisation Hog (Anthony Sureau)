import matplotlib.pyplot as plt
from skimage.feature import hog
from skimage import exposure, color
import cv2
import numpy as np

#Une fois que l'image est importé
img = "chemin de l'image"
img_bgr = cv2.imread(img)

#Converti en niveaux de gris
image_gray = cv2.cvtColor(img_bgr, cv2.COLOR_BGR2GRAY)

features, hog_image = hog(
    image_gray,
    orientations=9,             # nombre de directions
    pixels_per_cell=(8, 8),     # taille d’une cellule
    cells_per_block=(2, 2),     # taille d’un bloc
    visualize=True,
    block_norm="L2-Hys"
)

print("Taille du vecteur HOG :", features.shape)

#Graphique
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(12, 6), sharex=True, sharey=True)

ax1.imshow(image_gray, cmap=plt.cm.gray)
ax1.set_title("Image originale")

#Amélioration du contraste pour visualiser le HOG
hog_image_rescaled = exposure.rescale_intensity(hog_image, in_range=(0, 10))
ax2.imshow(hog_image_rescaled, cmap=plt.cm.gray)
ax2.set_title("HOG")

plt.show()

#Valeurs obtenues

#Dimensions de l'image
height, width = image_gray.shape
print(f"Dimensions de l'image : {width} x {height}")

#Taille du vecteur HOG
print(f"Taille du vecteur HOG : {features.shape[0]}")

#Calcul du nombre de cellules
cell_size = (8, 8)
cells_x = width // cell_size[1]
cells_y = height // cell_size[0]
print(f"Nombre de cellules : {cells_x} x {cells_y} = {cells_x*cells_y} cellules")

#Nombre de blocs (2x2 cellules par bloc)
block_size = (2, 2)
blocks_x = cells_x - block_size[1] + 1
blocks_y = cells_y - block_size[0] + 1
print(f"Nombre de blocs : {blocks_x} x {blocks_y} = {blocks_x*blocks_y} blocs")

#Histogramme moyen par cellule
hog_per_cell = features.reshape(blocks_y, blocks_x, block_size[0], block_size[1], 9)
mean_hist = np.mean(hog_per_cell)
print(f"Valeur moyenne des histogrammes HOG : {mean_hist:.4f}")
