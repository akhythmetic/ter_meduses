import os
import cv2
import numpy as np
from skimage.feature import hog
from skimage import exposure
import matplotlib.pyplot as plt

#Les différents dossier
frames_folder = "/content/frames_meduses"    #dossier contenant les frames originales
hog_output_folder = "/content/hog_frames"   #dossier pour sauvegarder les images HOG
os.makedirs(hog_output_folder, exist_ok=True)

#Liste toutes les images
image_files = [f for f in os.listdir(frames_folder) if f.endswith(('.jpg', '.png'))]
image_files.sort()

#Boucle sur toutes les images
for img_file in image_files:
    img_path = os.path.join(frames_folder, img_file)
    image_bgr = cv2.imread(img_path)

    if image_bgr is None:
        print(f"Impossible de lire {img_path}")
        continue

    #Convertir en niveaux de gris
    image_gray = cv2.cvtColor(image_bgr, cv2.COLOR_BGR2GRAY)

    #Calcul des HOG
    features, hog_image = hog(
        image_gray,
        orientations=9,
        pixels_per_cell=(8, 8),
        cells_per_block=(2, 2),
        visualize=True,
        block_norm="L2-Hys"
    )

    #Permet de crée la figure
    fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(12, 6), sharex=True, sharey=True)
    ax1.imshow(image_gray, cmap=plt.cm.gray)
    ax1.set_title(f"Original: {img_file}")
    hog_image_rescaled = exposure.rescale_intensity(hog_image, in_range=(0, 10))
    ax2.imshow(hog_image_rescaled, cmap=plt.cm.gray)
    ax2.set_title("HOG")
    ax1.axis('off')
    ax2.axis('off')

    # Sauvegarde les hogs calculés dans le fichier hog_output_folder
    output_path = os.path.join(hog_output_folder, f"hog_{img_file}")
    plt.savefig(output_path)
    plt.close(fig)  # fermer la figure pour ne pas surcharger la mémoire

    print(f"HOG sauvegardé pour {img_file}") #Permet de savoir ou en est le calcul des hogs. A chaque image calculé, il va afficher une ligne pour dire que les hogs sont calculés pour tel images.
